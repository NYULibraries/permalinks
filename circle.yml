machine:
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
    - pip install docker-compose
    - sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.10.0-circleci'
    - sudo chmod 0755 /usr/bin/docker
  services:
    - docker

general:
  branches:
    only:
      - master
      - /feature\/.+/
      - /bug\/.+/
      - /chore\/.+/

dependencies:
  override:
    - docker version
    - docker-compose version
    - docker-compose up -d

database:
  override:
    - echo "Do nothing"

test:
  override:
    - docker-compose run -e RAILS_ENV=test test rake
